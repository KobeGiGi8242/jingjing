<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>二维码扫描</title>
</head>
<body>
<h1 id="err">测试</h1>

<video id="video" width="300" height="300"></video>
<button id="scan">扫描二维码</button>
<h1 id="title"></h1>

<script>
    let title = document.getElementById("title");
    document.getElementById('scan').addEventListener('click', function() {
        // 获取视频流
        try{
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(stream) {
                    var video = document.getElementById('video');
                    video.srcObject = stream;
                    video.play();

                    // 创建BarcodeDetector实例
                    var barcodeDetector = new BarcodeDetector();

                    // 扫描二维码
                    barcodeDetector.detect(video)
                        .then(function(barcodes) {
                            barcodes.forEach(function(barcode) {
                                console.log('扫描结果: ' + barcode.rawValue);
                                title.innerText = `扫码结果 ${barcode.rawValue}`;
                            });
                        })
                        .catch(function(error) {
                            console.error('扫描二维码出错: ', error);
                            title.innerText = `获取摄像头出错 ${error}`;
                        });
                })
                .catch(function(error) {
                    console.error('获取摄像头出错: ', error);
                    title.innerText = `获取摄像头出错 ${error}`;
                });
        }catch(e){
            let err = document.getElementById("err");
            err.innerText = e;
        }

    });
</script>
</body>
</html>